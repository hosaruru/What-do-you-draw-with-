<div class="example">
<canvas id="canvas" class="back"></canvas>
<div class="example2">
<div style="background-color: #17a2b8; text-align: center; color: white;">
  <%= flash[:notice] %>
</div>

<div class='mt-5', id="title">
		<p>
		<span>P</span>
		<span>O</span>
		<span>S</span>
		<span>T</span>
		<span style ="margin-right:20px;">S</span>
		<span>L</span>
		<span>I</span>
		<span>S</span>
		<span>T</span>
		<span>S</span>
	</p>
</div>
<div class="wrap">
	<div class="top">
	<% if user_signed_in? %>
		<%=  %>
	<% else %>
		<%= link_to 'ゲストログイン（閲覧用）', posts_guest_sign_in_path, method: :post , class: "btn btn-primary btn-sm px-4" %>
		<p>※ログインすると詳細が見れます</p>
	<% end %>
		<%= search_form_for @q, url: search_posts_path do |f| %>
		  <%= f.label :brush_cont, '線画ペン検索' %>
		  <%= f.search_field :brush_cont , class: 'search_container'%>
		  <%= f.submit '検索' ,class: "btn btn-dark btn-sm"%>
		<% end %>
		<%= search_form_for @q, url: search_posts_path do |f| %>
		  <%= f.label :pens_use_pen_cont, '塗りペン検索' %>
		  <%= f.search_field :pens_use_pen_cont, class: 'search_container' %>
		
		  <%= f.submit '検索' ,class: "btn btn-dark btn-sm"%>
		<% end %>	
	<% @tag_lists.each do |list| %>
		<span> <%= link_to "#"+list.tag_name, posts_path(tag_id: list.id), class: 'btn btn-info btn-sm' %></span>
	<% end %>
	<% @post.tags.each do |tag| %>
		<%= link_to "##{tag.tag_name}", posts_path(tag), class: 'smaller tag_list' %>
	<% end %>
	</div>
	<div class='container px-5 px-sm-0'>
		<div class='row'>
			<div class='col-md-8 offset-md-1' style='margin: 0 auto;'>
				<table class='table table-hover table-inverse'>
					<tbody>
					<% if user_signed_in? %>
						<% @posts.each do |post| %>
							<div class="container">
							<div class="row o-2column">
								<div class="col-md-8 ml-4">
								<%= link_to post_path(post.id) do %>
									<%= post.twitter.to_s.html_safe %>
								</div>
								<div class="ml-3 col-md-3">
								<h5><i class="bi bi-person-fill"></i></i> ユーザー</h5>
									<p><%= link_to user_path(post.user.id) do %><%= post.user.user_name %><% end %></p>
								<h5><i class="bi bi-magic"></i> 使用ソフト</h5>
									<p>・<%= post.software.name %></p>
								<h5><i class="bi bi-pen"></i> 線画ペン</h5>
									<p>・<%= post.brush %></p>
								<h5><i class="bi bi-pencil-fill"></i> 塗りペン</h5>
								<% post.pens.each do |use_pen| %>
									<% if use_pen.present? %>
										<p>・<%= use_pen.use_pen %></p>
									<% end %>
								<% end %>
								<br>
									<p><%= link_to "詳細", post_path(post.id),class: "btn btn-success"  %></p>
									<%= "#{post.post_comments.count} コメント" %>
								</div>							
								<% end %>
							</div>
							</div>
						<% end %>
						<% else %>
						<% @posts.each do |post| %>
							<div class="container">
								<div class="row o-2column">
									<div class="col-md-8 ml-4">
									<%= link_to post_path(post.id) do %>
										<%= post.twitter.to_s.html_safe %>
									</div>
									<div class="ml-3 col-md-3">
									<h5><i class="bi bi-magic"></i> 使用ソフト</h5>
										<p>・<%= post.software.name %></p>
									<h5><i class="bi bi-pen"></i> 線画ペン</h5>
										<p>・<%= post.brush %></p>
									<h5><i class="bi bi-pencil-fill"></i>塗りペン</h5>
										<% post.pens.each do |use_pen| %>
											<% if use_pen.present? %>
												<p>・<%= use_pen.use_pen %></p>
											<% end %>
										<% end %><br>								
									</div>							
									<% end %>
								</div>
							</div>
						<% end %>
					<% end %>
					</tbody>
				</table>
			</div>
		</div>
		<ul class="pagination"><li class="page-item"><%= paginate @posts%></li></ul>
	</div>
</div>
</div>
</div>
<script>
var livePatern = {
  canvas: null,
  context: null,
  cols: 0,
  rows: 0,
  colors: [252, 251, 249, 248, 241, 240],
  triangleColors: [],
  destColors: [],
  
  init: function(){
    this.canvas = document.getElementById('canvas');
    console.log("test")
    console.log(this)
    console.log(this.canvas.getContext('2d'))
    this.context = this.canvas.getContext('2d');
    this.cols = Math.floor(document.body.clientWidth / 24);
    this.rows = Math.floor(document.body.clientHeight / 24) + 1;
    
    this.canvas.width = document.body.clientWidth;
    this.canvas.height = document.body.clientHeight;
    
    this.drawBackground();
    this.animate();
  },
  
  drawTriangle: function(x, y, color, inverted){
    inverted = inverted == undefined ? false : inverted;

    this.context.beginPath();
    this.context.moveTo(x, y);
    this.context.lineTo(inverted ? x - 22 : x + 22, y + 11);
    this.context.lineTo(x, y + 22);
    this.context.fillStyle = "rgb("+color+","+color+","+color+")";
    this.context.fill();
    this.context.closePath();
  },
  
  getColor: function(){    
    return this.colors[(Math.floor(Math.random() * 6))];
  },
  
  drawBackground: function(){
    var eq = null;
    var x = this.cols;
    var destY = 0;
    var color, y;
    
    while(x--){
      eq = x % 2;
      y = this.rows;

      while(y--){
        destY = Math.round((y-0.5) * 24);

        this.drawTriangle(x * 24 + 2, eq == 1 ? destY : y * 24, this.getColor());
        this.drawTriangle(x * 24, eq == 1 ? destY  : y * 24, this.getColor(), true);
      }
    }
  },
  
  animate: function(){
    var me = this;

    var x = Math.floor(Math.random() * this.cols);
    var y = Math.floor(Math.random() * this.rows);
    var eq = x % 2;

    if (eq == 1) {
      me.drawTriangle(x * 24, Math.round((y-0.5) * 24) , this.getColor(), true);
    } else {
      me.drawTriangle(x * 24 + 2, y * 24, this.getColor());
    }

    setTimeout(function(){    
      me.animate.call(me);
    }, 10);
  },
};

!function(){livePatern.init();}()
</script>


